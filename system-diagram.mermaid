graph TD
    A[User] -->|Question| B(Main System)
    B -->|Extract Text & Date| C[Web Scraper]
    C -->|URLs| D[BeautifulSoup]
    D -->|Text & Metadata| E[Text Splitter]
    E -->|Chunks| F[TF-IDF Vectorizer]
    E -->|Chunks| G[Upstage Embeddings]
    F -->|Sparse Vectors| H[Sparse Retrieval]
    G -->|Dense Vectors| I[Dense Retrieval]
    I -->|Store Embeddings| J[Pinecone Index]
    B -->|Query| K[Get Best Docs]
    K -->|Retrieve| H
    K -->|Retrieve| J
    K -->|Combined Results| L[Answer Generation]
    L -->|Format Docs| M[Prompt Template]
    M -->|Generate Initial Answer| N[Upstage LLM]
    N -->|Initial Answer| O[Refine Chain]
    O -->|Final Answer| P[Format Response]
    P -->|Answer with URLs| A
